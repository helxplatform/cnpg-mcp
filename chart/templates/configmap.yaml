{{- if not .Values.oidc.existingSecret }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "cnpg-mcp.fullname" . }}-oidc-config
  labels:
    {{- include "cnpg-mcp.labels" . | nindent 4 }}
data:
  oidc.yaml: |
    # OIDC/OAuth2 Authentication Configuration
    # Auto-generated from Helm values

    # REQUIRED: OIDC Issuer URL
    issuer: {{ .Values.oidc.issuer | quote }}

    # REQUIRED: Expected audience claim in JWT tokens
    audience: {{ .Values.oidc.audience | quote }}

    {{- if .Values.oidc.jwksUri }}
    # OPTIONAL: Override JWKS URI (auto-discovered from issuer by default)
    jwks_uri: {{ .Values.oidc.jwksUri | quote }}
    {{- end }}

    {{- if .Values.oidc.dcrProxyUrl }}
    # OPTIONAL: DCR (Dynamic Client Registration) proxy URL
    dcr_proxy_url: {{ .Values.oidc.dcrProxyUrl | quote }}
    {{- end }}

    {{- if .Values.oidc.scope }}
    # OPTIONAL: Required OAuth2 scope
    scope: {{ .Values.oidc.scope | quote }}
    {{- end }}
{{- end }}
